<!DOCTYPE html>
<html>
<head>
    <title>个人设置</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="../assets/css/common.css"/>
    <link rel="stylesheet" href="../assets/css/style.css"/>
    <script type="text/javascript" src="../assets/js/jquery-1.10.1.min.js"></script>
    <script type="text/javascript" src="../assets/js/jquery.imgareaselect.pack.js"></script>
    <script type="text/javascript" src="../assets/js/jQueryRotate.js"></script>
    <script type="text/javascript" src="../assets/js/common.js"></script>
</head>
<body>
<div class="wrapper w">
    <!--左边内容开始-->
    <div class="left-sidebar fl">
        <div class="img-box">
            <a href=""><img src="images/header.png" alt=""/></a>
        </div>
        <ul class="left-nav">
            <li><a href="">我的主页</a></li>
            <li class="dropdown">
                <a href="javascript:void(null)">我的乐淘</a>
                <ul class="dropdown-menu">
                    <li><a href="javascript:void(null)">乐淘记录</a></li>
                    <li><a href="javascript:void(null)">获得的商品</a></li>
                    <li><a href="javascript:void(null)">晒单</a></li>
                </ul>
                <span class="icon-arrow"></span>
            </li>
            <li class="dropdown">
                <a href="javascript:void(null)">帐户管理</a>
                <ul class="dropdown-menu">
                    <li><a href="javascript:void(null)">帐户明细</a></li>
                    <li><a href="javascript:void(null)">帐号充值</a></li>
                </ul>
                <span class="icon-arrow"></span>
            </li>
            <li><a href="">消息管理</a></li>
            <li><a href="">个人设置</a></li>
        </ul>
    </div>
    <!--右左边内容结束-->
    <div class="set-wrap">
        <div class="navbar-inner">
            <ul>
                <li class="active">个人资料</li>
                <li>更换头像</li>
                <li>修改密码</li>
                <li>收货地址</li>
            </ul>
        </div>
        <!--修改资头像-->
        <div class="portWarp">
            <!--选择图片-->
            <div class="portrait_left">
                <p>支持jpg、png、gif格式，可以在大图片片中剪裁满意的部分</p>
                <div class="file-img">
                    <input id="avatarUpload" type="file" name="avatar" multiple="">
                </div>
                <div id="picture">
                    <img id="avatar" alt="请上传头像" src="../assets/img/96515277.jpg">
                </div>
                <form id="crop_form" method="post" action=".">
                    <!--通过生成尺寸和旋转角度 后台获取尺寸和旋转角度再进行裁剪-->
                    <input id="id_top" type="hidden" name="top" value="90">
                    <input id="id_left" type="hidden" name="left" value="61">
                    <input id="id_right" type="hidden" name="right" value="201">
                    <input id="id_bottom" type="hidden" name="bottom" value="200">
                    <input id="rotation" type="hidden" value="0" name="rotation">
                </form>
                <div class="revolveMenu">
                    <a href="javascript:;" class="revol_left" onClick="avatarrotateleft();">向左旋转</a>
                    <a href="javascript:;" class="revol_right" onClick="avatarrotateright();">向右旋转</a>
                </div>
                <div class="setup_but">
                    <button class="btn btn-md btn-red" onClick="submit_avatar();"><s class="rotate-left"></s>确定</button>
                    <button class="btn btn-md btn-gy" onClick="submit_avatar();"><s class="rotate-right"></s>取消</button>
                </div>
            </div>
            <div class="portrait_right">
                <p>您上传的头像会自动生成小尺寸头像，请注意小尺寸的头像是否清晰</p>
                <div class="portrait1">
                     <div id="preview-big" class="img_preview">
                           <img id="avatar1" alt="头像预览" src="../assets/img/96515277.jpg">
                     </div>
                     <p>大尺寸头像，140×140</p>
                </div>
                <div class="portrait2">
                    <div id="preview-small" class="img_preview">
                        <img id="avatar2" alt="预览" src="../assets/img/96515277.jpg">
                    </div>
                    <p>中尺寸头像60×60</p>
                </div>
            </div>
        </div>
        </div>
        </div>

    </div>
</div>

<script type="text/javascript">
    $(document).ready(function (){
        function adjust(el, selection) {
            var scaleX = $(el).width() / (selection.width || 1);
            var scaleY = $(el).height() / (selection.width || 1);
            $(el+' img').css({
                width: Math.round(scaleX*$('#avatar').width() ) + 'px',
                height: Math.round(scaleY*$('#avatar').height() ) + 'px',
                marginLeft: '-' + Math.round(scaleX * selection.x1) + 'px',
                marginTop: '-' + Math.round(scaleY * selection.y1) + 'px'
            });
        }
        function preview(img, selection) {
            adjust('#preview-small', selection);
            adjust('#preview-big', selection);
        }
        $('img#avatar').imgAreaSelect({
            aspectRatio: "4:4",
            x1: 60,
            y1:60,
            x2: 200,
            y2: 200,
            onSelectEnd:function(img, selection) {
                $('#id_top').val(selection.y1);
                $('#id_left').val(selection.x1);
                $('#id_right').val(selection.x2);
                $('#id_bottom').val(selection.y2);
            },
            onSelectChange: preview
        });
    });



    var value = 0;
    function avatarrotateleft(){
        value -=90;
        $('#avatar').rotate({ animateTo:value});
        $('#avatar1').rotate({ animateTo:value});
        $('#avatar2').rotate({ animateTo:value});
    }
    function avatarrotateright(){
        value +=90;
        $('#avatar').rotate({ animateTo:value});
        $('#avatar1').rotate({ animateTo:value});
        $('#avatar2').rotate({ animateTo:value});
    }
    function select_avatar(){
        $('#avatar_id').click();
    }
    function uploadavatar(){
        $('#avatar_form').submit();
    }
    function submit_avatar(){
        $('#rotation').val(value);
        alert('修改成功');
        $('#crop_form').submit();
    }
</script>
</body>
</html>